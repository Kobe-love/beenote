import{_ as J}from"./logo-FnfcyM4Z.js";import{d as O,p as Q,h as W,r as X,q as Y,g as m,i as s,c as y,e as n,w as t,F as w,s as S,t as f,v as te,m as B,x,_ as Z,u as ne,y as ae,o as oe,b as d,j as z,z as b,A}from"./index-Br0JMTEE.js";import{g as le}from"./index-CPWKPUAP.js";const se={class:"tag-nav"},re=O({__name:"TagNav",setup(P){const k=Q(),N=W(),_=X([]),v=p=>p.path===k.path,u=async p=>{const{path:i,meta:a,params:o,name:c}=p;if(a!=null&&a.title){let g=a.title;if(p.name==="NoteView"&&o.id)try{g=(await le(o.id)).data.title}catch(V){console.error("获取笔记标题失败:",V)}const M={title:g,path:i,params:o,name:c};_.value.some(V=>V.path===i)||_.value.push(M)}},I=p=>{const i=_.value;let a=k.path;a===p&&i.forEach((o,c)=>{if(o.path===p){const g=i[c+1]||i[c-1];g&&(a=g.path)}}),_.value=i.filter(o=>o.path!==p),a&&a!==k.path&&N.push(a)},L=p=>{p.name&&p.params?N.push({name:p.name,params:p.params}):N.push(p.path)};return Y(()=>k.path,async()=>{await u(k)},{immediate:!0}),(p,i)=>{const a=m("el-tag"),o=m("el-scrollbar");return s(),y("div",se,[n(o,{class:"scroll-container"},{default:t(()=>[(s(!0),y(w,null,S(_.value,c=>(s(),f(a,{key:c.path,type:v(c)?"primary":"info",effect:v(c)?"dark":"plain",class:te({active:v(c)}),round:"",closable:"",onClick:g=>L(c),onClose:g=>I(c.path)},{default:t(()=>[B(x(c.title),1)]),_:2},1032,["type","effect","class","onClick","onClose"]))),128))]),_:1})])}}}),K=Z(re,[["__scopeId","data-v-65bfde30"]]),ue={class:"header-content"},ce={class:"header-right"},de={class:"user-dropdown"},ie={class:"username"},_e={class:"sub-header"},pe={class:"header-right"},me={class:"user-dropdown"},fe={class:"username"},he=O({__name:"Layout",setup(P){const k=Q(),N=W(),_=ne(),v=X(localStorage.getItem("layoutMode")||"horizontal"),u=i=>(i.children||[]).filter(a=>{var o;return!((o=a.meta)!=null&&o.hidden)}),I=ae(()=>N.options.routes.filter(a=>a.path!=="/login"&&a.children).filter(a=>{var o,c;return(o=a.meta)!=null&&o.roles?a.meta.roles.includes(((c=_.user)==null?void 0:c.role)||""):!0}));Y(v,i=>{localStorage.setItem("layoutMode",i)});const L=i=>{i==="logout"?(_.logout(),N.push("/login")):i==="switchLayout"&&(v.value=v.value==="vertical"?"horizontal":"vertical")},p=async()=>{try{await _.initialize()}catch(i){console.error("获取用户信息失败:",i),_.clearUser(),N.push("/login")}};return oe(()=>{_.token&&p()}),(i,a)=>{const o=m("el-icon"),c=m("el-menu-item"),g=m("el-sub-menu"),M=m("el-menu"),V=m("el-avatar"),D=m("ArrowDown"),T=m("el-dropdown-item"),E=m("SwitchButton"),F=m("el-dropdown-menu"),R=m("el-dropdown"),$=m("el-header"),U=m("router-view"),j=m("el-main"),ee=m("el-aside"),q=m("el-container");return s(),f(q,{class:"layout-container"},{default:t(()=>[v.value==="horizontal"?(s(),y(w,{key:0},[n($,{height:"60px",class:"horizontal-header"},{default:t(()=>[d("div",ue,[a[2]||(a[2]=d("div",{class:"logo horizontal"},[d("img",{src:J,alt:"logo",class:"logo-img"}),d("h1",null,"蜜蜂笔记")],-1)),n(M,{router:!0,"default-active":z(k).path,mode:"horizontal",class:"horizontal-menu"},{default:t(()=>[(s(!0),y(w,null,S(I.value,e=>(s(),y(w,{key:e.path},[u(e).length>1?(s(),f(g,{key:0,index:e.path},{title:t(()=>{var l;return[n(o,null,{default:t(()=>{var r,h;return[(r=e.meta)!=null&&r.icon?(s(),f(b((h=e.meta)==null?void 0:h.icon),{key:0})):A("",!0)]}),_:2},1024),d("span",null,x((l=e.meta)==null?void 0:l.title),1)]}),default:t(()=>[(s(!0),y(w,null,S(u(e),l=>(s(),f(c,{key:l.path,index:l.path},{default:t(()=>{var r;return[n(o,null,{default:t(()=>{var h,C;return[(h=l.meta)!=null&&h.icon?(s(),f(b((C=l.meta)==null?void 0:C.icon),{key:0})):A("",!0)]}),_:2},1024),d("span",null,x((r=l.meta)==null?void 0:r.title),1)]}),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):(s(),f(c,{key:1,index:u(e).length===1?u(e)[0].path:e.path},{default:t(()=>{var l,r;return[n(o,null,{default:t(()=>{var h,C,G,H;return[(u(e).length===1?(h=u(e)[0].meta)!=null&&h.icon:(C=e.meta)!=null&&C.icon)?(s(),f(b(u(e).length===1?(G=u(e)[0].meta)==null?void 0:G.icon:(H=e.meta)==null?void 0:H.icon),{key:0})):A("",!0)]}),_:2},1024),d("span",null,x(u(e).length===1?(l=u(e)[0].meta)==null?void 0:l.title:(r=e.meta)==null?void 0:r.title),1)]}),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active"]),d("div",ce,[n(R,{onCommand:L},{dropdown:t(()=>[n(F,null,{default:t(()=>[n(T,{command:"switchLayout"},{default:t(()=>[n(o,null,{default:t(()=>[(s(),f(b(v.value==="horizontal"?"Expand":"Fold")))]),_:1}),a[0]||(a[0]=B(" 切换布局 "))]),_:1}),n(T,{command:"logout"},{default:t(()=>[n(o,null,{default:t(()=>[n(E)]),_:1}),a[1]||(a[1]=B(" 退出登录 "))]),_:1})]),_:1})]),default:t(()=>{var e,l,r;return[d("span",de,[n(V,{size:32,src:((e=z(_).user)==null?void 0:e.avatar)||"/src/assets/logo.png"},null,8,["src"]),d("span",ie,x(((l=z(_).user)==null?void 0:l.name)||((r=z(_).user)==null?void 0:r.username)),1),n(o,null,{default:t(()=>[n(D)]),_:1})])]}),_:1})])])]),_:1}),d("div",_e,[n(K)]),n(j,null,{default:t(()=>[n(U)]),_:1})],64)):(s(),y(w,{key:1},[n(ee,{width:"200px"},{default:t(()=>[a[3]||(a[3]=d("div",{class:"logo"},[d("img",{src:J,alt:"logo",class:"logo-img"}),d("h1",null,"蜜蜂笔记")],-1)),n(M,{router:!0,"default-active":z(k).path,class:"menu"},{default:t(()=>[(s(!0),y(w,null,S(I.value,e=>(s(),y(w,{key:e.path},[u(e).length>1?(s(),f(g,{key:0,index:e.path},{title:t(()=>{var l;return[n(o,null,{default:t(()=>{var r;return[(s(),f(b((r=e.meta)==null?void 0:r.icon)))]}),_:2},1024),d("span",null,x((l=e.meta)==null?void 0:l.title),1)]}),default:t(()=>[(s(!0),y(w,null,S(u(e),l=>(s(),f(c,{key:l.path,index:l.path},{default:t(()=>{var r;return[n(o,null,{default:t(()=>{var h;return[(s(),f(b((h=l.meta)==null?void 0:h.icon)))]}),_:2},1024),d("span",null,x((r=l.meta)==null?void 0:r.title),1)]}),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):(s(),f(c,{key:1,index:u(e).length===1?u(e)[0].path:e.path},{default:t(()=>{var l,r;return[n(o,null,{default:t(()=>{var h,C;return[(s(),f(b(u(e).length===1?(h=u(e)[0].meta)==null?void 0:h.icon:(C=e.meta)==null?void 0:C.icon)))]}),_:2},1024),d("span",null,x(u(e).length===1?(l=u(e)[0].meta)==null?void 0:l.title:(r=e.meta)==null?void 0:r.title),1)]}),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active"])]),_:1}),n(q,null,{default:t(()=>[n($,null,{default:t(()=>[d("div",pe,[n(R,{onCommand:L},{dropdown:t(()=>[n(F,null,{default:t(()=>[n(T,{command:"switchLayout"},{default:t(()=>[n(o,null,{default:t(()=>[(s(),f(b(v.value==="vertical"?"Fold":"Expand")))]),_:1}),a[4]||(a[4]=B(" 切换布局 "))]),_:1}),n(T,{command:"logout"},{default:t(()=>[n(o,null,{default:t(()=>[n(E)]),_:1}),a[5]||(a[5]=B(" 退出登录 "))]),_:1})]),_:1})]),default:t(()=>{var e,l,r;return[d("span",me,[n(V,{size:32,src:((e=z(_).user)==null?void 0:e.avatar)||"/src/assets/logo.png"},null,8,["src"]),d("span",fe,x(((l=z(_).user)==null?void 0:l.name)||((r=z(_).user)==null?void 0:r.username)),1),n(o,null,{default:t(()=>[n(D)]),_:1})])]}),_:1})]),n(K)]),_:1}),n(j,null,{default:t(()=>[n(U)]),_:1})]),_:1})],64))]),_:1})}}}),we=Z(he,[["__scopeId","data-v-c83376d7"]]);export{we as default};

import{d as y,u as C,r,y as m,o as x,c as L,e as _,w as u,E,h,f as M,i as q,j as N,b,x as B,p as S,_ as T}from"./index-BSenUYUZ.js";const V={class:"oauth-callback"},A={class:"card-header"},H={class:"callback-content"},O=y({__name:"OAuthCallback",setup(R){const o=M(),g=q(),c=C(),l=r(!0),p=r(!1),i=r("正在处理登录请求..."),d=r("请稍候"),f=m(()=>({wecom:"企业微信",feishu:"飞书",dingtalk:"钉钉",github:"GitHub"})[o.query.state]||"未知平台"),v=m(()=>`${f.value}登录`),k=async()=>{var n;try{const e=o.query.code,s=o.query.authCode,t=(n=o.query.state)==null?void 0:n.toLowerCase();if(console.log("code:",e),console.log("authCode:",s),console.log("state:",t),!e||!t||!s&&t==="dingtalk"&&t!=="github")throw new Error("缺少必要的参数");let a;switch(t){case"wecom":a=await c.wecomLogin(e);break;case"feishu":a=await c.feishuLogin(e);break;case"dingtalk":a=await c.dingtalkLogin(s);break;case"github":a=await c.githubLogin(e);break;default:throw new Error("未知的登录类型")}l.value=!1,i.value="登录成功",d.value="正在跳转...",setTimeout(()=>{g.push("/")},1e3)}catch(e){l.value=!1,p.value=!0,i.value="登录失败",d.value=e.message||"请稍后重试",E.error(e.message||"登录失败")}},w=()=>{g.push("/")};return x(()=>{k()}),(n,e)=>{const s=h("el-button"),t=h("el-result"),a=h("el-card");return N(),L("div",V,[_(a,{class:"callback-card"},{header:u(()=>[b("div",A,[b("h2",null,B(v.value),1)])]),default:u(()=>[b("div",H,[_(t,{icon:l.value?"info":p.value?"error":"success",title:i.value,"sub-title":d.value},{extra:u(()=>[_(s,{type:"primary",onClick:w,disabled:l.value},{default:u(()=>e[0]||(e[0]=[S(" 返回首页 ")])),_:1},8,["disabled"])]),_:1},8,["icon","title","sub-title"])])]),_:1})])}}}),D=T(O,[["__scopeId","data-v-bf38b6b7"]]);export{D as default};

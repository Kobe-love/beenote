import{d as y,u as C,r as n,y as v,o as x,c as E,e as _,w as r,E as L,g as p,p as M,h as q,i as N,b as h,x as B,m as S,_ as T}from"./index-Br0JMTEE.js";const V={class:"oauth-callback"},A={class:"card-header"},O={class:"callback-content"},R=y({__name:"OAuthCallback",setup(D){const o=M(),m=q(),u=C(),c=n(!0),g=n(!1),i=n("正在处理登录请求..."),d=n("请稍候"),f=v(()=>({wecom:"企业微信",feishu:"飞书",dingtalk:"钉钉"})[o.query.state]||"未知平台"),b=v(()=>`${f.value}登录`),k=async()=>{var l;try{const e=o.query.code,a=o.query.authCode,t=(l=o.query.state)==null?void 0:l.toLowerCase();if(console.log("code:",e),console.log("authCode:",a),console.log("state:",t),!e||!t||!a&&t==="dingtalk")throw new Error("缺少必要的参数");let s;switch(t){case"wecom":s=await u.wecomLogin(e);break;case"feishu":s=await u.feishuLogin(e);break;case"dingtalk":s=await u.dingtalkLogin(a);break;default:throw new Error("未知的登录类型")}c.value=!1,i.value="登录成功",d.value="正在跳转...",setTimeout(()=>{m.push("/")},1e3)}catch(e){c.value=!1,g.value=!0,i.value="登录失败",d.value=e.message||"请稍后重试",L.error(e.message||"登录失败")}},w=()=>{m.push("/")};return x(()=>{k()}),(l,e)=>{const a=p("el-button"),t=p("el-result"),s=p("el-card");return N(),E("div",V,[_(s,{class:"callback-card"},{header:r(()=>[h("div",A,[h("h2",null,B(b.value),1)])]),default:r(()=>[h("div",O,[_(t,{icon:c.value?"info":g.value?"error":"success",title:i.value,"sub-title":d.value},{extra:r(()=>[_(a,{type:"primary",onClick:w,disabled:c.value},{default:r(()=>e[0]||(e[0]=[S(" 返回首页 ")])),_:1},8,["disabled"])]),_:1},8,["icon","title","sub-title"])])]),_:1})])}}}),I=T(R,[["__scopeId","data-v-4c6985a1"]]);export{I as default};

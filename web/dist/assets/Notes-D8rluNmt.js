import{d as ze,C as k,r as i,x as Z,D as xe,p as Ne,u as Ue,y as Ae,c as C,b as r,e,w as o,h as d,F as V,E as ee,s as y,G as I,f as n,H as Se,g as $e,o as p,I as Me,j as _,q as te,J as Be,K as De,L as Te,M as Ee,v as m,N as ae,O as le,A as oe,P as ne,Q as Ie,R as Pe,S as z,T as Ge,_ as Le}from"./index-B1xyQZS1.js";import{c as Re,d as je,e as Fe,f as Ke,u as qe}from"./index-BzLWzpi_.js";import{r as He}from"./relativeTime-C-Apik07.js";import{M as Je}from"./style-CY9VOONx.js";const Oe={class:"notes-container"},Qe={class:"header"},We={class:"left"},Xe={class:"right"},Ye=["onClick"],Ze={class:"pagination-container"},et={class:"note-card-header"},tt={class:"title"},at={class:"header-right"},lt={class:"note-card-content"},ot={class:"note-card-footer"},nt={class:"time"},st={class:"pagination-container"},ut=ze({__name:"Notes",setup(dt){k.extend(He);const x=$e(),P=i([]),G=i([]),N=i(!1),b=i(null),U=i(""),A=i("grid"),f=i(1),g=i(10),S=i(0),L=Z(()=>P.value),se=l=>k(l).fromNow(),ue=({row:l})=>{const a=k(),u=k(l.updated_at);return a.diff(u,"day")<1?"recent-row":""},h=async()=>{N.value=!0;try{const l=await Re({page:f.value,page_size:g.value,group__id:b.value||void 0});P.value=l.data.results,S.value=l.data.count}catch(l){console.error(l),I.error("获取笔记列表失败")}finally{N.value=!1}},de=async()=>{try{const l=await je();G.value=l.data}catch(l){console.error(l)}},re=()=>{x.push("/notes/edit")},R=l=>{x.push(`/notes/edit/${l.id}`)},j=async l=>{try{await Ie.confirm("确定要删除该笔记吗？","提示",{type:"warning"}),await Fe(l.id),await h()}catch(a){console.error(a)}},ie=xe(()=>{h()},300),F=l=>{g.value=l,f.value=1,h()},K=l=>{f.value=l,h()},q=l=>{x.push(`/notes/view/${l.id}`)};Ne([b,U],()=>{f.value=1,h()});const $=i(!1),H=i([]),M=i(!1),w=i(null),J=async l=>{w.value=l,$.value=!0,await ce()},ce=async()=>{if(w.value){M.value=!0;try{const l=await Ke();H.value=l.data.map(a=>{var u;return{...a,hasAuth:(u=a.notes)==null?void 0:u.includes(w.value.id)}})}catch(l){console.error(l)}finally{M.value=!1}}},pe=async l=>{var a,u;if(w.value)try{const c=l.hasAuth?[...l.notes||[],w.value.id]:(l.notes||[]).filter(D=>D!==w.value.id);await qe(l.id,{note:c,note_group:l.note_group||[]}),l.notes=c,I.success("授权更新成功")}catch(c){console.error(c),I.error(((u=(a=c.response)==null?void 0:a.data)==null?void 0:u.detail)||"授权更新失败"),l.hasAuth=!l.hasAuth}},_e=Ue(),B=Z(()=>{var l;return((l=_e.user)==null?void 0:l.role)==="admin"});return Ae(()=>{h(),de()}),(l,a)=>{const u=n("el-icon"),c=n("el-button"),D=n("el-option"),fe=n("el-select"),ve=n("el-input"),O=n("el-radio-button"),me=n("el-radio-group"),v=n("el-table-column"),T=n("el-tag"),ge=n("el-button-group"),Q=n("el-table"),W=n("el-pagination"),E=n("el-dropdown-item"),he=n("el-dropdown-menu"),we=n("el-dropdown"),ye=n("el-card"),Ce=n("el-col"),be=n("el-row"),ke=n("el-switch"),Ve=n("el-dialog"),X=Se("loading");return p(),C("div",Oe,[r("div",Qe,[r("div",We,[e(c,{type:"primary",onClick:re},{default:o(()=>[e(u,null,{default:o(()=>[e(d(Me))]),_:1}),a[9]||(a[9]=_("新建笔记 "))]),_:1}),e(fe,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=t=>b.value=t),placeholder:"选择分组",clearable:"",class:"group-select"},{default:o(()=>[(p(!0),C(V,null,te(G.value,t=>(p(),y(D,{key:t.id,label:t.name,value:t.id},{default:o(()=>[e(u,null,{default:o(()=>[e(d(Pe))]),_:1}),r("span",null,m(t.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),r("div",Xe,[e(ve,{modelValue:U.value,"onUpdate:modelValue":a[1]||(a[1]=t=>U.value=t),placeholder:"搜索笔记",class:"search-input",onInput:d(ie)},{prefix:o(()=>[e(u,null,{default:o(()=>[e(d(Be))]),_:1})]),_:1},8,["modelValue","onInput"]),e(me,{modelValue:A.value,"onUpdate:modelValue":a[2]||(a[2]=t=>A.value=t),size:"small"},{default:o(()=>[e(O,{label:"table"},{default:o(()=>[e(u,null,{default:o(()=>[e(d(De))]),_:1})]),_:1}),e(O,{label:"grid"},{default:o(()=>[e(u,null,{default:o(()=>[e(d(Te))]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),A.value==="table"?(p(),C(V,{key:0},[ee((p(),y(Q,{data:L.value,"row-class-name":ue,stripe:""},{default:o(()=>[e(v,{prop:"title",label:"标题"},{default:o(({row:t})=>[r("div",{class:"note-title clickable",onClick:s=>q(t)},[e(u,null,{default:o(()=>[e(d(Ee))]),_:1}),r("span",null,m(t.title),1)],8,Ye)]),_:1}),e(v,{prop:"group_id",label:"分组"},{default:o(({row:t})=>[e(T,{size:"small"},{default:o(()=>{var s;return[_(m(((s=t.group_detail)==null?void 0:s.name)||"-"),1)]}),_:2},1024)]),_:1}),e(v,{prop:"created_at",label:"创建时间",width:"180"}),e(v,{prop:"updated_at",label:"更新时间",width:"180"}),e(v,{label:"操作",width:B.value?280:200,fixed:"right"},{default:o(({row:t})=>[e(ge,null,{default:o(()=>[e(c,{type:"primary",icon:d(ae),onClick:s=>R(t)},{default:o(()=>a[10]||(a[10]=[_(" 编辑 ")])),_:2},1032,["icon","onClick"]),B.value?(p(),y(c,{key:0,type:"success",icon:d(le),onClick:s=>J(t)},{default:o(()=>a[11]||(a[11]=[_(" 授权 ")])),_:2},1032,["icon","onClick"])):oe("",!0),e(c,{type:"danger",icon:d(ne),onClick:s=>j(t)},{default:o(()=>a[12]||(a[12]=[_(" 删除 ")])),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1},8,["width"])]),_:1},8,["data"])),[[X,N.value]]),r("div",Ze,[e(W,{"current-page":f.value,"onUpdate:currentPage":a[3]||(a[3]=t=>f.value=t),"page-size":g.value,"onUpdate:pageSize":a[4]||(a[4]=t=>g.value=t),"page-sizes":[10,20,50,100],total:S.value,layout:"total, sizes, prev, pager, next",onSizeChange:F,onCurrentChange:K},null,8,["current-page","page-size","total"])])],64)):(p(),C(V,{key:1},[e(be,{gutter:20},{default:o(()=>[(p(!0),C(V,null,te(L.value,t=>(p(),y(Ce,{span:6,key:t.id},{default:o(()=>[e(ye,{class:"note-card","body-style":{padding:"15px"},shadow:"hover",onClick:s=>q(t)},{default:o(()=>[r("div",et,[r("span",tt,m(t.title),1),r("div",at,[e(T,{size:"small",type:"warning",effect:"plain",class:"creator-tag"},{default:o(()=>{var s,Y;return[_(m(((s=t.creator)==null?void 0:s.name)||((Y=t.creator)==null?void 0:Y.username)),1)]}),_:2},1024),e(we,{trigger:"click"},{dropdown:o(()=>[e(he,null,{default:o(()=>[e(E,{onClick:z(s=>R(t),["stop"])},{default:o(()=>[e(u,null,{default:o(()=>[e(d(ae))]),_:1}),a[13]||(a[13]=_("编辑 "))]),_:2},1032,["onClick"]),B.value?(p(),y(E,{key:0,onClick:z(s=>J(t),["stop"])},{default:o(()=>[e(u,null,{default:o(()=>[e(d(le))]),_:1}),a[14]||(a[14]=_("授权 "))]),_:2},1032,["onClick"])):oe("",!0),e(E,{onClick:z(s=>j(t),["stop"]),class:"danger"},{default:o(()=>[e(u,null,{default:o(()=>[e(d(ne))]),_:1}),a[15]||(a[15]=_("删除 "))]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[e(c,{type:"text",onClick:a[5]||(a[5]=z(()=>{},["stop"]))},{default:o(()=>[e(u,null,{default:o(()=>[e(d(Ge))]),_:1})]),_:1})]),_:2},1024)])]),r("div",lt,[e(d(Je),{modelValue:t.content.slice(0,100)||""},null,8,["modelValue"])]),r("div",ot,[e(T,{size:"small"},{default:o(()=>{var s;return[_(m(((s=t.group_detail)==null?void 0:s.name)||"-"),1)]}),_:2},1024),r("span",nt,m(se(t.updated_at)),1)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1}),r("div",st,[e(W,{"current-page":f.value,"onUpdate:currentPage":a[6]||(a[6]=t=>f.value=t),"page-size":g.value,"onUpdate:pageSize":a[7]||(a[7]=t=>g.value=t),"page-sizes":[10,20,50,100],total:S.value,layout:"total, sizes, prev, pager, next",onSizeChange:F,onCurrentChange:K},null,8,["current-page","page-size","total"])])],64)),e(Ve,{modelValue:$.value,"onUpdate:modelValue":a[8]||(a[8]=t=>$.value=t),title:"笔记授权",width:"600px"},{default:o(()=>[ee((p(),y(Q,{data:H.value,style:{width:"100%"}},{default:o(()=>[e(v,{prop:"username",label:"用户名"}),e(v,{prop:"name",label:"姓名"}),e(v,{label:"授权",width:"100"},{default:o(({row:t})=>[e(ke,{modelValue:t.hasAuth,"onUpdate:modelValue":s=>t.hasAuth=s,onChange:s=>pe(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1},8,["data"])),[[X,M.value]])]),_:1},8,["modelValue"])])}}}),_t=Le(ut,[["__scopeId","data-v-f0409703"]]);export{_t as default};

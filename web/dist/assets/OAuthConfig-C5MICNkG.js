import{a8 as s,d as se,u as pe,E as h,r as k,y as te,q as fe,o as ge,c as F,e as l,w as a,i as me,h as _,H as be,j as V,b as u,p as o,x as D,k as C,I as M,G as O,t as j,N as Q,P as z,F as J,A as K,Q as ce,_ as ve}from"./index-DUSGohFq.js";const p={getWeComConfigs:()=>s.get("/auth/wecom-config/"),createWeComConfig:n=>s.post("/auth/wecom-config/",n),updateWeComConfig:(n,w)=>s.patch(`/auth/wecom-config/${n}/`,w),deleteWeComConfig:n=>s.delete(`/auth/wecom-config/${n}/`),getCurrentWeComConfig:()=>s.get("/auth/wecom-config/current/"),getFeiShuConfigs:()=>s.get("/auth/feishu-config/"),createFeiShuConfig:n=>s.post("/auth/feishu-config/",n),updateFeiShuConfig:(n,w)=>s.patch(`/auth/feishu-config/${n}/`,w),deleteFeiShuConfig:n=>s.delete(`/auth/feishu-config/${n}/`),getCurrentFeiShuConfig:()=>s.get("/auth/feishu-config/current/"),getDingTalkConfigs:()=>s.get("/auth/dingtalk-config/"),createDingTalkConfig:n=>s.post("/auth/dingtalk-config/",n),updateDingTalkConfig:(n,w)=>s.patch(`/auth/dingtalk-config/${n}/`,w),deleteDingTalkConfig:n=>s.delete(`/auth/dingtalk-config/${n}/`),getCurrentDingTalkConfig:()=>s.get("/auth/dingtalk-config/current/"),getGitHubConfigs:()=>s.get("/auth/github-config/"),createGitHubConfig:n=>s.post("/auth/github-config/",n),updateGitHubConfig:(n,w)=>s.patch(`/auth/github-config/${n}/`,w),deleteGitHubConfig:n=>s.delete(`/auth/github-config/${n}/`),getCurrentGitHubConfig:()=>s.get("/auth/github-config/current/")},_e={class:"oauth-config-container"},Ce={class:"config-tips"},ke={class:"tab-header"},we={class:"config-tips"},he={class:"tab-header"},Ve={class:"config-tips"},ye={class:"tab-header"},De={class:"config-tips"},Ue={class:"tab-header"},$e=se({__name:"OAuthConfig",setup(n){var le;const w=me();((le=pe().user)==null?void 0:le.role)!=="superuser"&&(h.error("只有超级管理员可以访问此页面"),w.push("/"));const m=k("wecom"),U=k(!1),L=k(!1),y=k(null),I=k(),X=k([]),Y=k([]),Z=k([]),ee=k([]),$=k({wecom:!1,feishu:!1,dingtalk:!1,github:!1}),i=k({corp_id:"",agent_id:"",secret:"",app_id:"",app_secret:"",client_id:"",client_secret:"",redirect_uri:"",enabled:!0}),ae=te(()=>{const g=y.value?"编辑":"新建",e={wecom:"企业微信",feishu:"飞书",dingtalk:"钉钉",github:"GitHub"}[m.value];return`${g}${e}配置`}),ie={corp_id:[{required:!0,message:"请输入企业ID",trigger:"blur"}],agent_id:[{required:!0,message:"请输入应用ID",trigger:"blur"}],secret:[{required:!0,message:"请输入应用密钥",trigger:"blur"}],app_id:[{required:!0,message:"请输入应用ID",trigger:"blur"}],app_secret:[{required:!0,message:"请输入应用密钥",trigger:"blur"}],client_id:[{required:!0,message:"请输入Client ID",trigger:"blur"}],client_secret:[{required:!0,message:"请输入Client Secret",trigger:"blur"}]},G=async()=>{try{switch($.value[m.value]=!0,m.value){case"wecom":const g=await p.getWeComConfigs();X.value=g.data;break;case"feishu":const e=await p.getFeiShuConfigs();Y.value=e.data;break;case"dingtalk":const r=await p.getDingTalkConfigs();Z.value=r.data;break;case"github":const S=await p.getGitHubConfigs();ee.value=S.data;break}}catch(g){console.error(g),h.error("获取配置列表失败")}finally{$.value[m.value]=!1}},oe=()=>{i.value={corp_id:"",agent_id:"",secret:"",app_id:"",app_secret:"",client_id:"",client_secret:"",redirect_uri:"",enabled:!0},y.value=null,I.value&&I.value.resetFields()},H=g=>{m.value=g,oe(),U.value=!0},B=(g,e)=>{console.log("handleEdit",e),m.value=g,y.value=e,Object.assign(i.value,e),U.value=!0},q=async(g,e)=>{try{switch(await ce.confirm("确定要删除该配置吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),g){case"wecom":await p.deleteWeComConfig(e.id);break;case"feishu":await p.deleteFeiShuConfig(e.id);break;case"dingtalk":await p.deleteDingTalkConfig(e.id);break;case"github":await p.deleteGitHubConfig(e.id);break}h.success("删除成功"),G()}catch(r){r!=="cancel"&&(console.error(r),h.error("删除失败"))}},W=async(g,e)=>{try{const r={enabled:e.enabled};switch(g){case"wecom":await p.updateWeComConfig(e.id,r);break;case"feishu":await p.updateFeiShuConfig(e.id,r);break;case"dingtalk":await p.updateDingTalkConfig(e.id,r);break;case"github":await p.updateGitHubConfig(e.id,r);break}h.success("更新状态成功")}catch(r){console.error(r),h.error("更新状态失败"),e.enabled=!e.enabled}},ne=async()=>{I.value&&await I.value.validate(async g=>{if(g){L.value=!0;try{const e={...i.value};if(y.value){switch(m.value){case"wecom":await p.updateWeComConfig(y.value.id,e);break;case"feishu":await p.updateFeiShuConfig(y.value.id,e);break;case"dingtalk":await p.updateDingTalkConfig(y.value.id,e);break;case"github":await p.updateGitHubConfig(y.value.id,e);break}h.success("更新成功")}else{switch(m.value){case"wecom":await p.createWeComConfig(e);break;case"feishu":await p.createFeiShuConfig(e);break;case"dingtalk":await p.createDingTalkConfig(e);break;case"github":await p.createGitHubConfig(e);break}h.success("创建成功")}U.value=!1,G()}catch(e){console.error(e),h.error("保存失败")}finally{L.value=!1}}})};fe(m,()=>{G()}),ge(()=>{G()});const x=te(()=>window.location.origin),R=()=>{i.value.redirect_uri||(i.value.redirect_uri=`${x.value}/oauth/callback`)};return(g,e)=>{const r=_("el-link"),S=_("el-icon"),c=_("el-button"),d=_("el-table-column"),T=_("el-switch"),A=_("el-button-group"),E=_("el-table"),N=_("el-tab-pane"),ue=_("el-tabs"),v=_("el-input"),b=_("el-form-item"),de=_("el-form"),re=_("el-dialog"),P=be("loading");return V(),F("div",_e,[l(ue,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=t=>m.value=t)},{default:a(()=>[l(N,{label:"企业微信配置",name:"wecom"},{default:a(()=>[u("div",Ce,[e[25]||(e[25]=u("p",null,"配置说明：",-1)),u("p",null,[e[23]||(e[23]=o("1. 请先前往 ")),l(r,{href:"https://work.weixin.qq.com/wework_admin/frame#profile",type:"primary",target:"_blank"},{default:a(()=>e[22]||(e[22]=[o("企业微信管理后台")])),_:1}),e[24]||(e[24]=o(" 获取相关配置"))]),u("p",null,"2. 回调域名请填写："+D(x.value)+"/oauth/callback",1),e[26]||(e[26]=u("p",null,"3. 授权范围请选择：企业内部开发 - 通讯录",-1))]),u("div",ke,[l(c,{type:"primary",onClick:e[0]||(e[0]=t=>H("wecom")),disabled:X.value.length>=1},{default:a(()=>[l(S,null,{default:a(()=>[l(C(M))]),_:1}),e[27]||(e[27]=o("新建配置 "))]),_:1},8,["disabled"])]),O((V(),j(E,{data:X.value},{default:a(()=>[l(d,{prop:"corp_id",label:"企业ID",width:"300"}),l(d,{prop:"agent_id",label:"应用ID",width:"200"}),l(d,{prop:"secret",label:"应用密钥","show-overflow-tooltip":""}),l(d,{prop:"redirect_uri",label:"回调域名","show-overflow-tooltip":""},{default:a(({row:t})=>[l(r,{type:"primary",href:t.redirect_uri,target:"_blank",underline:!1},{default:a(()=>[o(D(t.redirect_uri),1)]),_:2},1032,["href"])]),_:1}),l(d,{prop:"enabled",label:"状态",width:"100"},{default:a(({row:t})=>[l(T,{modelValue:t.enabled,"onUpdate:modelValue":f=>t.enabled=f,onChange:f=>W("wecom",t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(d,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(A,null,{default:a(()=>[l(c,{type:"primary",icon:C(Q),onClick:f=>B("wecom",t)},{default:a(()=>e[28]||(e[28]=[o(" 编辑 ")])),_:2},1032,["icon","onClick"]),l(c,{type:"danger",icon:C(z),onClick:f=>q("wecom",t)},{default:a(()=>e[29]||(e[29]=[o(" 删除 ")])),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[P,$.value.wecom]])]),_:1}),l(N,{label:"飞书配置",name:"feishu"},{default:a(()=>[u("div",we,[e[33]||(e[33]=u("p",null,"配置说明：",-1)),u("p",null,[e[31]||(e[31]=o("1. 请先前往 ")),l(r,{href:"https://open.feishu.cn/app",type:"primary",target:"_blank"},{default:a(()=>e[30]||(e[30]=[o("飞书开放平台")])),_:1}),e[32]||(e[32]=o(" 获取相关配置"))]),u("p",null,"2. 回调域名请填写："+D(x.value)+"/oauth/callback",1),e[34]||(e[34]=u("p",null,"3. 权限请选择：获取用户基本信息",-1))]),u("div",he,[l(c,{type:"primary",onClick:e[1]||(e[1]=t=>H("feishu")),disabled:Y.value.length>=1},{default:a(()=>[l(S,null,{default:a(()=>[l(C(M))]),_:1}),e[35]||(e[35]=o("新建配置 "))]),_:1},8,["disabled"])]),O((V(),j(E,{data:Y.value},{default:a(()=>[l(d,{prop:"app_id",label:"应用ID"}),l(d,{prop:"app_secret",label:"应用密钥","show-overflow-tooltip":""}),l(d,{prop:"redirect_uri",label:"回调域名","show-overflow-tooltip":""},{default:a(({row:t})=>[l(r,{type:"primary",href:t.redirect_uri,target:"_blank",underline:!1},{default:a(()=>[o(D(t.redirect_uri),1)]),_:2},1032,["href"])]),_:1}),l(d,{prop:"enabled",label:"状态",width:"100"},{default:a(({row:t})=>[l(T,{modelValue:t.enabled,"onUpdate:modelValue":f=>t.enabled=f,onChange:f=>W("feishu",t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(d,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(A,null,{default:a(()=>[l(c,{type:"primary",icon:C(Q),onClick:f=>B("feishu",t)},{default:a(()=>e[36]||(e[36]=[o(" 编辑 ")])),_:2},1032,["icon","onClick"]),l(c,{type:"danger",icon:C(z),onClick:f=>q("feishu",t)},{default:a(()=>e[37]||(e[37]=[o(" 删除 ")])),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[P,$.value.feishu]])]),_:1}),l(N,{label:"钉钉配置",name:"dingtalk"},{default:a(()=>[u("div",Ve,[e[41]||(e[41]=u("p",null,"配置说明：",-1)),u("p",null,[e[39]||(e[39]=o("1. 请先前往 ")),l(r,{href:"https://open-dev.dingtalk.com/fe/app#/corp/app",type:"primary",target:"_blank"},{default:a(()=>e[38]||(e[38]=[o("钉钉开放平台")])),_:1}),e[40]||(e[40]=o(" 获取相关配置"))]),u("p",null,"2. 回调域名请填写："+D(x.value)+"/oauth/callback",1),e[42]||(e[42]=u("p",null,"3. 权限请选择：通讯录个人信息读权限",-1))]),u("div",ye,[l(c,{type:"primary",onClick:e[2]||(e[2]=t=>H("dingtalk")),disabled:Z.value.length>=1},{default:a(()=>[l(S,null,{default:a(()=>[l(C(M))]),_:1}),e[43]||(e[43]=o("新建配置 "))]),_:1},8,["disabled"])]),O((V(),j(E,{data:Z.value},{default:a(()=>[l(d,{prop:"app_id",label:"APP ID",width:"350"}),l(d,{prop:"client_id",label:"Client ID",width:"200"}),l(d,{prop:"client_secret",label:"Client Secret","show-overflow-tooltip":""}),l(d,{prop:"redirect_uri",label:"回调域名","show-overflow-tooltip":""},{default:a(({row:t})=>[l(r,{type:"primary",href:t.redirect_uri,target:"_blank",underline:!1},{default:a(()=>[o(D(t.redirect_uri),1)]),_:2},1032,["href"])]),_:1}),l(d,{prop:"enabled",label:"状态",width:"100"},{default:a(({row:t})=>[l(T,{modelValue:t.enabled,"onUpdate:modelValue":f=>t.enabled=f,onChange:f=>W("dingtalk",t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(d,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(A,null,{default:a(()=>[l(c,{type:"primary",icon:C(Q),onClick:f=>B("dingtalk",t)},{default:a(()=>e[44]||(e[44]=[o(" 编辑 ")])),_:2},1032,["icon","onClick"]),l(c,{type:"danger",icon:C(z),onClick:f=>q("dingtalk",t)},{default:a(()=>e[45]||(e[45]=[o(" 删除 ")])),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[P,$.value.dingtalk]])]),_:1}),l(N,{label:"GitHub配置",name:"github"},{default:a(()=>[u("div",De,[e[49]||(e[49]=u("p",null,"配置说明：",-1)),u("p",null,[e[47]||(e[47]=o("1. 请先前往 ")),l(r,{href:"https://github.com/settings/developers",type:"primary",target:"_blank"},{default:a(()=>e[46]||(e[46]=[o("GitHub开发者设置")])),_:1}),e[48]||(e[48]=o(" 获取相关配置"))]),u("p",null,"2. 回调域名请填写："+D(x.value)+"/oauth/callback",1),e[50]||(e[50]=u("p",null,"3. 权限范围请选择：read:user, user:email",-1))]),u("div",Ue,[l(c,{type:"primary",onClick:e[3]||(e[3]=t=>H("github")),disabled:ee.value.length>=1},{default:a(()=>[l(S,null,{default:a(()=>[l(C(M))]),_:1}),e[51]||(e[51]=o("新建配置 "))]),_:1},8,["disabled"])]),O((V(),j(E,{data:ee.value},{default:a(()=>[l(d,{prop:"client_id",label:"Client ID",width:"300"}),l(d,{prop:"client_secret",label:"Client Secret","show-overflow-tooltip":""}),l(d,{prop:"redirect_uri",label:"回调域名","show-overflow-tooltip":""},{default:a(({row:t})=>[l(r,{type:"primary",href:t.redirect_uri,target:"_blank",underline:!1},{default:a(()=>[o(D(t.redirect_uri),1)]),_:2},1032,["href"])]),_:1}),l(d,{prop:"enabled",label:"状态",width:"100"},{default:a(({row:t})=>[l(T,{modelValue:t.enabled,"onUpdate:modelValue":f=>t.enabled=f,onChange:f=>W("github",t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(d,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(A,null,{default:a(()=>[l(c,{type:"primary",icon:C(Q),onClick:f=>B("github",t)},{default:a(()=>e[52]||(e[52]=[o(" 编辑 ")])),_:2},1032,["icon","onClick"]),l(c,{type:"danger",icon:C(z),onClick:f=>q("github",t)},{default:a(()=>e[53]||(e[53]=[o(" 删除 ")])),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[P,$.value.github]])]),_:1})]),_:1},8,["modelValue"]),l(re,{modelValue:U.value,"onUpdate:modelValue":e[21]||(e[21]=t=>U.value=t),title:ae.value,width:"500px"},{footer:a(()=>[l(c,{onClick:e[20]||(e[20]=t=>U.value=!1)},{default:a(()=>e[54]||(e[54]=[o("取消")])),_:1}),l(c,{type:"primary",onClick:ne,loading:L.value},{default:a(()=>e[55]||(e[55]=[o(" 确定 ")])),_:1},8,["loading"])]),default:a(()=>[l(de,{ref_key:"formRef",ref:I,model:i.value,rules:ie,"label-width":"120px"},{default:a(()=>[m.value==="wecom"?(V(),F(J,{key:0},[l(b,{label:"企业ID",prop:"corp_id"},{default:a(()=>[l(v,{modelValue:i.value.corp_id,"onUpdate:modelValue":e[5]||(e[5]=t=>i.value.corp_id=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"应用ID",prop:"agent_id"},{default:a(()=>[l(v,{modelValue:i.value.agent_id,"onUpdate:modelValue":e[6]||(e[6]=t=>i.value.agent_id=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"应用密钥",prop:"secret"},{default:a(()=>[l(v,{modelValue:i.value.secret,"onUpdate:modelValue":e[7]||(e[7]=t=>i.value.secret=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(b,{label:"回调域名",prop:"redirect_uri"},{default:a(()=>[l(v,{modelValue:i.value.redirect_uri,"onUpdate:modelValue":e[8]||(e[8]=t=>i.value.redirect_uri=t),placeholder:"留空将自动使用当前域名",onBlur:R},null,8,["modelValue"])]),_:1})],64)):K("",!0),m.value==="feishu"?(V(),F(J,{key:1},[l(b,{label:"应用ID",prop:"app_id"},{default:a(()=>[l(v,{modelValue:i.value.app_id,"onUpdate:modelValue":e[9]||(e[9]=t=>i.value.app_id=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"应用密钥",prop:"app_secret"},{default:a(()=>[l(v,{modelValue:i.value.app_secret,"onUpdate:modelValue":e[10]||(e[10]=t=>i.value.app_secret=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(b,{label:"回调域名",prop:"redirect_uri"},{default:a(()=>[l(v,{modelValue:i.value.redirect_uri,"onUpdate:modelValue":e[11]||(e[11]=t=>i.value.redirect_uri=t),placeholder:"留空将自动使用当前域名",onBlur:R},null,8,["modelValue"])]),_:1})],64)):K("",!0),m.value==="dingtalk"?(V(),F(J,{key:2},[l(b,{label:"Client ID",prop:"client_id"},{default:a(()=>[l(v,{modelValue:i.value.client_id,"onUpdate:modelValue":e[12]||(e[12]=t=>i.value.client_id=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"Client Secret",prop:"client_secret"},{default:a(()=>[l(v,{modelValue:i.value.client_secret,"onUpdate:modelValue":e[13]||(e[13]=t=>i.value.client_secret=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(b,{label:"APP ID",prop:"app_id"},{default:a(()=>[l(v,{modelValue:i.value.app_id,"onUpdate:modelValue":e[14]||(e[14]=t=>i.value.app_id=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"回调域名",prop:"redirect_uri"},{default:a(()=>[l(v,{modelValue:i.value.redirect_uri,"onUpdate:modelValue":e[15]||(e[15]=t=>i.value.redirect_uri=t),placeholder:"留空将自动使用当前域名",onBlur:R},null,8,["modelValue"])]),_:1})],64)):K("",!0),m.value==="github"?(V(),F(J,{key:3},[l(b,{label:"Client ID",prop:"client_id"},{default:a(()=>[l(v,{modelValue:i.value.client_id,"onUpdate:modelValue":e[16]||(e[16]=t=>i.value.client_id=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"Client Secret",prop:"client_secret"},{default:a(()=>[l(v,{modelValue:i.value.client_secret,"onUpdate:modelValue":e[17]||(e[17]=t=>i.value.client_secret=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(b,{label:"回调域名",prop:"redirect_uri"},{default:a(()=>[l(v,{modelValue:i.value.redirect_uri,"onUpdate:modelValue":e[18]||(e[18]=t=>i.value.redirect_uri=t),placeholder:"留空将自动使用当前域名",onBlur:R},null,8,["modelValue"])]),_:1})],64)):K("",!0),l(b,{label:"状态",prop:"enabled"},{default:a(()=>[l(T,{modelValue:i.value.enabled,"onUpdate:modelValue":e[19]||(e[19]=t=>i.value.enabled=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),xe=ve($e,[["__scopeId","data-v-a46ebe83"]]);export{xe as default};

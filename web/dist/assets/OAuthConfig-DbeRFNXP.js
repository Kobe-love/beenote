import{a8 as p,d as de,u as se,E as C,r as k,y as le,q as pe,o as fe,c as F,e as l,w as a,i as ge,h as c,H as me,j as y,b as u,p as n,x as U,k as w,I as z,G as J,t as K,N as L,P as X,F as Y,A as Z,Q as ce,_ as ve}from"./index-C9JSwf0d.js";const f={getWeComConfigs:()=>p.get("/auth/wecom-config/"),createWeComConfig:i=>p.post("/auth/wecom-config/",i),updateWeComConfig:(i,V)=>p.patch(`/auth/wecom-config/${i}/`,V),deleteWeComConfig:i=>p.delete(`/auth/wecom-config/${i}/`),getCurrentWeComConfig:()=>p.get("/auth/wecom-config/current/"),getFeiShuConfigs:()=>p.get("/auth/feishu-config/"),createFeiShuConfig:i=>p.post("/auth/feishu-config/",i),updateFeiShuConfig:(i,V)=>p.patch(`/auth/feishu-config/${i}/`,V),deleteFeiShuConfig:i=>p.delete(`/auth/feishu-config/${i}/`),getCurrentFeiShuConfig:()=>p.get("/auth/feishu-config/current/"),getDingTalkConfigs:()=>p.get("/auth/dingtalk-config/"),createDingTalkConfig:i=>p.post("/auth/dingtalk-config/",i),updateDingTalkConfig:(i,V)=>p.patch(`/auth/dingtalk-config/${i}/`,V),deleteDingTalkConfig:i=>p.delete(`/auth/dingtalk-config/${i}/`),getCurrentDingTalkConfig:()=>p.get("/auth/dingtalk-config/current/")},_e={class:"oauth-config-container"},be={class:"config-tips"},ke={class:"tab-header"},Ce={class:"config-tips"},we={class:"tab-header"},Ve={class:"config-tips"},he={class:"tab-header"},ye=de({__name:"OAuthConfig",setup(i){var ee;const V=ge();((ee=se().user)==null?void 0:ee.role)!=="superuser"&&(C.error("只有超级管理员可以访问此页面"),V.push("/"));const g=k("wecom"),D=k(!1),q=k(!1),h=k(null),$=k(),B=k([]),W=k([]),A=k([]),S=k({wecom:!1,feishu:!1,dingtalk:!1}),o=k({corp_id:"",agent_id:"",secret:"",app_id:"",app_secret:"",client_id:"",client_secret:"",redirect_uri:"",enabled:!0}),te=le(()=>{const s=h.value?"编辑":"新建",e={wecom:"企业微信",feishu:"飞书",dingtalk:"钉钉"}[g.value];return`${s}${e}配置`}),ae={corp_id:[{required:!0,message:"请输入企业ID",trigger:"blur"}],agent_id:[{required:!0,message:"请输入应用ID",trigger:"blur"}],secret:[{required:!0,message:"请输入应用密钥",trigger:"blur"}],app_id:[{required:!0,message:"请输入应用ID",trigger:"blur"}],app_secret:[{required:!0,message:"请输入应用密钥",trigger:"blur"}],client_id:[{required:!0,message:"请输入Client ID",trigger:"blur"}],client_secret:[{required:!0,message:"请输入Client Secret",trigger:"blur"}]},I=async()=>{try{switch(S.value[g.value]=!0,g.value){case"wecom":const s=await f.getWeComConfigs();B.value=s.data;break;case"feishu":const e=await f.getFeiShuConfigs();W.value=e.data;break;case"dingtalk":const r=await f.getDingTalkConfigs();A.value=r.data;break}}catch(s){console.error(s),C.error("获取配置列表失败")}finally{S.value[g.value]=!1}},oe=()=>{o.value={corp_id:"",agent_id:"",secret:"",app_id:"",app_secret:"",client_id:"",client_secret:"",redirect_uri:"",enabled:!0},h.value=null,$.value&&$.value.resetFields()},R=s=>{g.value=s,oe(),D.value=!0},E=(s,e)=>{console.log("handleEdit",e),g.value=s,h.value=e,Object.assign(o.value,e),D.value=!0},N=async(s,e)=>{try{switch(await ce.confirm("确定要删除该配置吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s){case"wecom":await f.deleteWeComConfig(e.id);break;case"feishu":await f.deleteFeiShuConfig(e.id);break;case"dingtalk":await f.deleteDingTalkConfig(e.id);break}C.success("删除成功"),I()}catch(r){r!=="cancel"&&(console.error(r),C.error("删除失败"))}},P=async(s,e)=>{try{const r={enabled:e.enabled};switch(s){case"wecom":await f.updateWeComConfig(e.id,r);break;case"feishu":await f.updateFeiShuConfig(e.id,r);break;case"dingtalk":await f.updateDingTalkConfig(e.id,r);break}C.success("更新状态成功")}catch(r){console.error(r),C.error("更新状态失败"),e.enabled=!e.enabled}},ne=async()=>{$.value&&await $.value.validate(async s=>{if(s){q.value=!0;try{const e={...o.value};if(h.value){switch(g.value){case"wecom":await f.updateWeComConfig(h.value.id,e);break;case"feishu":await f.updateFeiShuConfig(h.value.id,e);break;case"dingtalk":await f.updateDingTalkConfig(h.value.id,e);break}C.success("更新成功")}else{switch(g.value){case"wecom":await f.createWeComConfig(e);break;case"feishu":await f.createFeiShuConfig(e);break;case"dingtalk":await f.createDingTalkConfig(e);break}C.success("创建成功")}D.value=!1,I()}catch(e){console.error(e),C.error("保存失败")}finally{q.value=!1}}})};pe(g,()=>{I()}),fe(()=>{I()});const x=le(()=>window.location.origin),M=()=>{o.value.redirect_uri||(o.value.redirect_uri=`${x.value}/oauth/callback`)};return(s,e)=>{const r=c("el-link"),O=c("el-icon"),_=c("el-button"),d=c("el-table-column"),T=c("el-switch"),j=c("el-button-group"),G=c("el-table"),H=c("el-tab-pane"),ie=c("el-tabs"),b=c("el-input"),v=c("el-form-item"),ue=c("el-form"),re=c("el-dialog"),Q=me("loading");return y(),F("div",_e,[l(ie,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t)},{default:a(()=>[l(H,{label:"企业微信配置",name:"wecom"},{default:a(()=>[u("div",be,[e[21]||(e[21]=u("p",null,"配置说明：",-1)),u("p",null,[e[19]||(e[19]=n("1. 请先前往 ")),l(r,{href:"https://work.weixin.qq.com/wework_admin/frame#profile",type:"primary",target:"_blank"},{default:a(()=>e[18]||(e[18]=[n("企业微信管理后台")])),_:1}),e[20]||(e[20]=n(" 获取相关配置"))]),u("p",null,"2. 回调域名请填写："+U(x.value)+"/oauth/callback",1),e[22]||(e[22]=u("p",null,"3. 授权范围请选择：企业内部开发 - 通讯录",-1))]),u("div",ke,[l(_,{type:"primary",onClick:e[0]||(e[0]=t=>R("wecom")),disabled:B.value.length>=1},{default:a(()=>[l(O,null,{default:a(()=>[l(w(z))]),_:1}),e[23]||(e[23]=n("新建配置 "))]),_:1},8,["disabled"])]),J((y(),K(G,{data:B.value},{default:a(()=>[l(d,{prop:"corp_id",label:"企业ID",width:"300"}),l(d,{prop:"agent_id",label:"应用ID",width:"200"}),l(d,{prop:"secret",label:"应用密钥","show-overflow-tooltip":""}),l(d,{prop:"redirect_uri",label:"回调域名","show-overflow-tooltip":""},{default:a(({row:t})=>[l(r,{type:"primary",href:t.redirect_uri,target:"_blank",underline:!1},{default:a(()=>[n(U(t.redirect_uri),1)]),_:2},1032,["href"])]),_:1}),l(d,{prop:"enabled",label:"状态",width:"100"},{default:a(({row:t})=>[l(T,{modelValue:t.enabled,"onUpdate:modelValue":m=>t.enabled=m,onChange:m=>P("wecom",t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(d,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(j,null,{default:a(()=>[l(_,{type:"primary",icon:w(L),onClick:m=>E("wecom",t)},{default:a(()=>e[24]||(e[24]=[n(" 编辑 ")])),_:2},1032,["icon","onClick"]),l(_,{type:"danger",icon:w(X),onClick:m=>N("wecom",t)},{default:a(()=>e[25]||(e[25]=[n(" 删除 ")])),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Q,S.value.wecom]])]),_:1}),l(H,{label:"飞书配置",name:"feishu"},{default:a(()=>[u("div",Ce,[e[29]||(e[29]=u("p",null,"配置说明：",-1)),u("p",null,[e[27]||(e[27]=n("1. 请先前往 ")),l(r,{href:"https://open.feishu.cn/app",type:"primary",target:"_blank"},{default:a(()=>e[26]||(e[26]=[n("飞书开放平台")])),_:1}),e[28]||(e[28]=n(" 获取相关配置"))]),u("p",null,"2. 回调域名请填写："+U(x.value)+"/oauth/callback",1),e[30]||(e[30]=u("p",null,"3. 权限请选择：获取用户基本信息",-1))]),u("div",we,[l(_,{type:"primary",onClick:e[1]||(e[1]=t=>R("feishu")),disabled:W.value.length>=1},{default:a(()=>[l(O,null,{default:a(()=>[l(w(z))]),_:1}),e[31]||(e[31]=n("新建配置 "))]),_:1},8,["disabled"])]),J((y(),K(G,{data:W.value},{default:a(()=>[l(d,{prop:"app_id",label:"应用ID"}),l(d,{prop:"app_secret",label:"应用密钥","show-overflow-tooltip":""}),l(d,{prop:"redirect_uri",label:"回调域名","show-overflow-tooltip":""},{default:a(({row:t})=>[l(r,{type:"primary",href:t.redirect_uri,target:"_blank",underline:!1},{default:a(()=>[n(U(t.redirect_uri),1)]),_:2},1032,["href"])]),_:1}),l(d,{prop:"enabled",label:"状态",width:"100"},{default:a(({row:t})=>[l(T,{modelValue:t.enabled,"onUpdate:modelValue":m=>t.enabled=m,onChange:m=>P("feishu",t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(d,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(j,null,{default:a(()=>[l(_,{type:"primary",icon:w(L),onClick:m=>E("feishu",t)},{default:a(()=>e[32]||(e[32]=[n(" 编辑 ")])),_:2},1032,["icon","onClick"]),l(_,{type:"danger",icon:w(X),onClick:m=>N("feishu",t)},{default:a(()=>e[33]||(e[33]=[n(" 删除 ")])),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Q,S.value.feishu]])]),_:1}),l(H,{label:"钉钉配置",name:"dingtalk"},{default:a(()=>[u("div",Ve,[e[37]||(e[37]=u("p",null,"配置说明：",-1)),u("p",null,[e[35]||(e[35]=n("1. 请先前往 ")),l(r,{href:"https://open-dev.dingtalk.com/fe/app#/corp/app",type:"primary",target:"_blank"},{default:a(()=>e[34]||(e[34]=[n("钉钉开放平台")])),_:1}),e[36]||(e[36]=n(" 获取相关配置"))]),u("p",null,"2. 回调域名请填写："+U(x.value)+"/oauth/callback",1),e[38]||(e[38]=u("p",null,"3. 权限请选择：通讯录个人信息读权限",-1))]),u("div",he,[l(_,{type:"primary",onClick:e[2]||(e[2]=t=>R("dingtalk")),disabled:A.value.length>=1},{default:a(()=>[l(O,null,{default:a(()=>[l(w(z))]),_:1}),e[39]||(e[39]=n("新建配置 "))]),_:1},8,["disabled"])]),J((y(),K(G,{data:A.value},{default:a(()=>[l(d,{prop:"app_id",label:"APP ID",width:"350"}),l(d,{prop:"client_id",label:"Client ID",width:"200"}),l(d,{prop:"client_secret",label:"Client Secret","show-overflow-tooltip":""}),l(d,{prop:"redirect_uri",label:"回调域名","show-overflow-tooltip":""},{default:a(({row:t})=>[l(r,{type:"primary",href:t.redirect_uri,target:"_blank",underline:!1},{default:a(()=>[n(U(t.redirect_uri),1)]),_:2},1032,["href"])]),_:1}),l(d,{prop:"enabled",label:"状态",width:"100"},{default:a(({row:t})=>[l(T,{modelValue:t.enabled,"onUpdate:modelValue":m=>t.enabled=m,onChange:m=>P("dingtalk",t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(d,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(j,null,{default:a(()=>[l(_,{type:"primary",icon:w(L),onClick:m=>E("dingtalk",t)},{default:a(()=>e[40]||(e[40]=[n(" 编辑 ")])),_:2},1032,["icon","onClick"]),l(_,{type:"danger",icon:w(X),onClick:m=>N("dingtalk",t)},{default:a(()=>e[41]||(e[41]=[n(" 删除 ")])),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Q,S.value.dingtalk]])]),_:1})]),_:1},8,["modelValue"]),l(re,{modelValue:D.value,"onUpdate:modelValue":e[17]||(e[17]=t=>D.value=t),title:te.value,width:"500px"},{footer:a(()=>[l(_,{onClick:e[16]||(e[16]=t=>D.value=!1)},{default:a(()=>e[42]||(e[42]=[n("取消")])),_:1}),l(_,{type:"primary",onClick:ne,loading:q.value},{default:a(()=>e[43]||(e[43]=[n(" 确定 ")])),_:1},8,["loading"])]),default:a(()=>[l(ue,{ref_key:"formRef",ref:$,model:o.value,rules:ae,"label-width":"120px"},{default:a(()=>[g.value==="wecom"?(y(),F(Y,{key:0},[l(v,{label:"企业ID",prop:"corp_id"},{default:a(()=>[l(b,{modelValue:o.value.corp_id,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.corp_id=t)},null,8,["modelValue"])]),_:1}),l(v,{label:"应用ID",prop:"agent_id"},{default:a(()=>[l(b,{modelValue:o.value.agent_id,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.agent_id=t)},null,8,["modelValue"])]),_:1}),l(v,{label:"应用密钥",prop:"secret"},{default:a(()=>[l(b,{modelValue:o.value.secret,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.secret=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(v,{label:"回调域名",prop:"redirect_uri"},{default:a(()=>[l(b,{modelValue:o.value.redirect_uri,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.redirect_uri=t),placeholder:"留空将自动使用当前域名",onBlur:M},null,8,["modelValue"])]),_:1})],64)):Z("",!0),g.value==="feishu"?(y(),F(Y,{key:1},[l(v,{label:"应用ID",prop:"app_id"},{default:a(()=>[l(b,{modelValue:o.value.app_id,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.app_id=t)},null,8,["modelValue"])]),_:1}),l(v,{label:"应用密钥",prop:"app_secret"},{default:a(()=>[l(b,{modelValue:o.value.app_secret,"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.app_secret=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(v,{label:"回调域名",prop:"redirect_uri"},{default:a(()=>[l(b,{modelValue:o.value.redirect_uri,"onUpdate:modelValue":e[10]||(e[10]=t=>o.value.redirect_uri=t),placeholder:"留空将自动使用当前域名",onBlur:M},null,8,["modelValue"])]),_:1})],64)):Z("",!0),g.value==="dingtalk"?(y(),F(Y,{key:2},[l(v,{label:"Client ID",prop:"client_id"},{default:a(()=>[l(b,{modelValue:o.value.client_id,"onUpdate:modelValue":e[11]||(e[11]=t=>o.value.client_id=t)},null,8,["modelValue"])]),_:1}),l(v,{label:"Client Secret",prop:"client_secret"},{default:a(()=>[l(b,{modelValue:o.value.client_secret,"onUpdate:modelValue":e[12]||(e[12]=t=>o.value.client_secret=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(v,{label:"APP ID",prop:"app_id"},{default:a(()=>[l(b,{modelValue:o.value.app_id,"onUpdate:modelValue":e[13]||(e[13]=t=>o.value.app_id=t)},null,8,["modelValue"])]),_:1}),l(v,{label:"回调域名",prop:"redirect_uri"},{default:a(()=>[l(b,{modelValue:o.value.redirect_uri,"onUpdate:modelValue":e[14]||(e[14]=t=>o.value.redirect_uri=t),placeholder:"留空将自动使用当前域名",onBlur:M},null,8,["modelValue"])]),_:1})],64)):Z("",!0),l(v,{label:"状态",prop:"enabled"},{default:a(()=>[l(T,{modelValue:o.value.enabled,"onUpdate:modelValue":e[15]||(e[15]=t=>o.value.enabled=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),$e=ve(ye,[["__scopeId","data-v-d93523e6"]]);export{$e as default};
